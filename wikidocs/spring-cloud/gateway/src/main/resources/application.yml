server:
  port: 8080 # ?????? MSA ?? ??? 8080? ??

spring:
  application:
    name: gateway-service # ??? ?? ??

  cloud:
    gateway:
      server:
        webflux:
          httpclient: # ?? ???? ??? ?? ?? ?? (?? : ms)
            response-timeout: 5000 # 5? ?? ??? ?? ??? ?? ??
            connect-timeout: 1000  # ?? ???? (????? ???? ??? ?? ??)
          default-filters: # ?? ???? ????? ??? ??
            - AuthenticationFilter # 'Filter' ???? ???? ?????? ??
          routes:  # ??? ?? ?? (routes? List ??)
            # --- ?? ??? ??? ---
                    - id: member-service-route # ? ???? ?? ID

                      # ? ???? ????? ??? ??? ??? URI
#                      uri: http://localhost:8081 # ??
                      uri: lb://MEMBER-SERVICE # lb? ?? ???? ??. "??? ??????? MEMBER-SERVICE?? ??? ?? ?? ??? ??"

                      # ? ???? ??? ?? (Predicates)
                      predicates:
                        - Path=/api/v1/members/** # /api/v1/members/? ???? ?? ??
                      # ?????? ?? member-service? ???? member-service? ?? ??? 'X-Request-Source: gateway-service'? ??? ?? ??? ?? ?
                      # ?????? ?? ???? 'X-Response-Source: gateway-service' ? ??? ? ??
                      # name: ?? ??, args: ??? ??? ?? (key:value)
                      filters:
                        - name: AddRequestHeader # ?? ??
                        - args:
                            name : X-Request-Source # ??? key
                            value : gateway-service # ??? value

                        # ???(????=??1, ??2,,)
                        - AddResponseHeader=X-Response-Source, gateway-service

                    # --- ?? ??? ??? ---
                    - id: product-service-route # ?? ???? ??? ?? ??
#                      uri: http://localhost:8082 # ??
                      uri : lb://PRODUCT-SERVICE
                      predicates:
                        - Path=/api/v1/products/**
                      # name: ?? ??, args: ??? ??? ?? (key:value)
                      filters:
                          - name: Retry # spring cloud gateway ?? ??
                            args:
                              retries: 3 # ?? 3??? ???
                              statuses: # ?? HTTP ?? ??? ? ??? ? ????
                                - BAD_GATEWAY # 502
                                - SERVICE_UNAVAILABLE # 503
                                - GATEWAY_TIMEOUT # 504
                              methods: # ?? HTTP?? ??? ? ????
                                - GET # ???(?? ? ???? ??? ??)? ???? GET, HEAD, OPTIONS ??? ??
                              backoff: # ??? ?? ??
                                firstBackoff: 100ms # ? ???? 100ms ??
                                maxBackoff: 500ms # ?? 500ms ?? ???
                                factor: 2 # ?? ??? 2?? ?? (100ms -> 200ms -> 400ms)
                                basedOnPreviousValue: true

                    # --- ?? ??? ??? ---
                    - id: order-service-route
                      uri: http://localhost:8083
                      predicates:
                        - Path=/api/v1/orders/**

                    - id : some-slow-service-route # ?: ?? ???? ???? ?? ???
                      uri : http://localhost:8888
                      predicates:
                        - Path=/api/v1/slow-service/**
                      metadata: # ?? ???? ?? ?? ?? ???
                        response-timeout : 10000 # ? ???? 10??? ???
                        connect-timeout : 2000


# ?? ??????? ?? ?? ??? ??
jwt:
  secret: 'a_very_long_and_secure_secret_key_for_ecommerce_project_that_is_at_least_256_bits_long'

# ??? ?? ??
# ??? ???? ?? ??? ??? ?? ??
security:
  required-roles: # 'role'?? ?? ?? ??
    - path: /api/v1/admin/** # '/api/v1/admin/**' ??? ADMIN ??? ??
      role: ADMIN
    - path: /api/v1/orders/** # '/api/v1/orders/**' ??? USER ??? ??
      role: USER

eureka:
  client:
    service-url:
      # 2. Eureka ??(?)? ??.
      defaultZone: http://localhost:8761/eureka/
  instance:
    # 3. IP ??? ????? ??
    prefer-ip-address: true
